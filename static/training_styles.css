/* --- METRO FLUX (Hybrid Modern/Solid) --- */
:root {
    /* Palette Base (Pulita e Luminosa) */
    --bg-primary: #ffffff;
    --bg-secondary: #f0f2f5;  /* Grigio "Cloud" solido */
    --bg-tertiary: #e4e6eb;
    
    /* Testo (Alto contrasto per leggibilità) */
    --text-primary: #050505;
    --text-secondary: #65676b;
    --text-tertiary: #8a8d91;
    
    /* Accenti "Metro" (Vibranti ma professionali) */
    --accent-primary: #0065ff; /* Blu Tech */
    --accent-hover: #0747a6;
    --accent-light: #e6effc;
    
    /* Stati */
    --success: #00875a;      /* Verde solido */
    --success-bg: #e3fcef;
    --error: #de350b;        /* Rosso solido */
    --error-bg: #ffebe6;
    
    --border: #dfe1e6;
    --shadow: rgba(9, 30, 66, 0.25);
    /* Ombra "Pop" più definita, meno sfocata */
    --card-shadow: 0 4px 8px -2px rgba(9, 30, 66, 0.25), 0 0 1px rgba(9, 30, 66, 0.31);
    
    --anim-speed: 0.2s;
    --radius-std: 6px; /* Angolo "Metro Moderno": né tondo né vivo */
}

[data-theme="dark"] {
    /* Dark Mode (Grigi scuri profondi, non nero assoluto) */
    --bg-primary: #242526;
    --bg-secondary: #18191a;
    --bg-tertiary: #3a3b3c;
    
    --text-primary: #e4e6eb;
    --text-secondary: #b0b3b8;
    --text-tertiary: #6d6f73;
    
    --accent-primary: #4599ff; /* Azzurro luminoso */
    --accent-hover: #2d88ff;
    --accent-light: rgba(69, 153, 255, 0.15);
    
    --success: #4ade80;
    --success-bg: rgba(22, 163, 74, 0.2);
    --error: #f87171;
    --error-bg: rgba(220, 38, 38, 0.2);
    
    --border: #3e4042;
    --shadow: rgba(0, 0, 0, 0.5);
    --card-shadow: 0 4px 8px -2px rgba(0, 0, 0, 0.5);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
    background-color: var(--bg-secondary); /* Sfondo pagina */
    color: var(--text-primary);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    transition: background var(--anim-speed) ease, color var(--anim-speed) ease;
}

/* --- CONTAINER PRINCIPALE --- */
.container {
    width: 100%;
    max-width: 1000px;
    background: var(--bg-primary);
    padding: 40px;
    border-radius: var(--radius-std);
    box-shadow: var(--card-shadow);
    border: 1px solid var(--border);
    position: relative;
    transition: background var(--anim-speed) ease;
}

/* --- THEME TOGGLE --- */
.theme-toggle {
    position: absolute;
    top: 20px;
    right: 20px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border);
    width: 48px;
    height: 48px;
    border-radius: var(--radius-std);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    transition: all var(--anim-speed) ease;
    z-index: 1001;
    color: var(--text-primary);
}

.theme-toggle:hover {
    transform: scale(1.05);
    background: var(--accent-primary);
    color: #fff;
    border-color: var(--accent-primary);
}

.hidden {
    display: none;
}

/* --- TYPOGRAPHY --- */
h1, h2 {
    font-weight: 700;
    /* Gradiente testuale leggero */
    background: linear-gradient(90deg, var(--accent-primary), #8b5cf6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-align: center;
    letter-spacing: -0.5px;
}

h1 { font-size: 2.5rem; margin-bottom: 30px; }
h2 { font-size: 2rem; margin-bottom: 20px; }

h3 {
    font-weight: 700;
    font-size: 1.4rem;
    text-align: center;
    color: var(--text-primary);
    margin-top: 25px;
}

/* --- FORMS & INPUTS --- */
.form-group { margin: 25px 0; }
#search-filters .form-group, #selection-filters .form-group { margin: 0; }
.form-group:first-of-type { margin-top: 0; }

.form-group label {
    display: block;
    font-size: 0.95rem;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--text-secondary);
}

.custom-select { position: relative; width: 100%; }

/* Selettori specifici come nel tuo originale per non perdere nulla */
#group-select, #rounds-input, #game-mode-select, #lastname-input, #group-guess-select, #seat-input,
#search-cognome-input, #search-nome-input, #search-gruppo-select, #search-committee-select,
#deputy-source-select, #select-cognome-input, #select-nome-input, #select-gruppo-select, #select-committee-select {
    width: 100%;
    padding: 14px 16px;
    font-size: 1rem;
    font-family: inherit;
    border: 2px solid var(--border); /* Bordo solido visibile */
    border-radius: var(--radius-std);
    background: var(--bg-secondary);
    color: var(--text-primary);
    cursor: pointer;
    transition: all var(--anim-speed) ease;
    appearance: none;
}

#rounds-input, #lastname-input, #search-cognome-input, #search-nome-input, #seat-input,
#select-cognome-input, #select-nome-input {
     appearance: textfield; cursor: text;
}

/* Focus evidente */
#group-select:focus, #rounds-input:focus, #game-mode-select:focus, #lastname-input:focus, 
#group-guess-select:focus, #seat-input:focus, #search-cognome-input:focus, #search-nome-input:focus, 
#search-gruppo-select:focus, #search-committee-select:focus, #deputy-source-select:focus,
#select-cognome-input:focus, #select-nome-input:focus, #select-gruppo-select:focus, #select-committee-select:focus {
    outline: none;
    border-color: var(--accent-primary);
    background: var(--bg-primary);
    box-shadow: 0 0 0 3px var(--accent-light);
}

/* Icone dropdown */
#group-select, #game-mode-select, #group-guess-select, #search-gruppo-select, #search-committee-select,
#deputy-source-select, #select-gruppo-select, #select-committee-select {
    padding-right: 45px;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%236366f1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 24px;
}

.setup-actions {
    display: flex; flex-direction: column; gap: 12px; margin-top: 25px;
}
@media (min-width: 640px) { .setup-actions { flex-direction: row; } }

/* --- PULSANTI (Stile "Flat 2.0") --- */
.btn-primary {
    width: 100%; flex: 1;
    padding: 16px 32px;
    font-size: 1.1rem;
    font-weight: 700;
    color: white;
    background: var(--accent-primary);
    border: none;
    border-radius: var(--radius-std);
    cursor: pointer;
    transition: all var(--anim-speed) ease;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.btn-primary:hover {
    background: var(--accent-hover);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
.btn-primary:active { transform: translateY(0); }

.btn-secondary, .btn-secondary-full {
    padding: 12px 20px;
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-primary);
    background: transparent;
    border: 2px solid var(--border);
    border-radius: var(--radius-std);
    cursor: pointer;
    transition: all var(--anim-speed) ease;
}
.btn-secondary-full { width: 100%; flex: 1; padding: 16px; font-size: 1rem; }

.btn-secondary:hover, .btn-secondary-full:hover {
    background: var(--bg-secondary);
    border-color: var(--accent-primary);
    color: var(--accent-primary);
}

.btn-secondary:disabled {
    color: var(--text-tertiary); border-color: var(--border);
    cursor: not-allowed; opacity: 0.7;
}

.info-text {
    margin-top: 20px; color: var(--text-secondary);
    font-size: 0.9rem; text-align: center;
}

/* --- GAME SCREEN UI --- */
.game-header {
    display: flex; justify-content: space-between; align-items: center;
    padding: 20px 24px;
    background: var(--bg-secondary);
    border-radius: var(--radius-std);
    margin-bottom: 30px;
    border-bottom: 2px solid var(--border);
}

.game-header > div:first-child {
    font-size: 1rem; font-weight: 600; color: var(--text-primary);
}
.game-header .score-text {
    color: var(--accent-primary); font-size: 1.2rem; margin-top: 4px;
}

#image-container {
    width: 280px; height: 373px; margin: 0 auto 30px auto;
    border-radius: var(--radius-std);
    overflow: hidden;
    box-shadow: var(--card-shadow);
    position: relative;
    border: 1px solid var(--border);
    background: var(--bg-tertiary);
}

#deputy-image { width: 100%; height: 100%; object-fit: cover; }

#answers-container {
    display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;
}

.answer-btn {
    padding: 20px;
    background: var(--bg-primary); /* Sfondo bianco/scuro */
    border: 2px solid var(--border);
    border-radius: var(--radius-std);
    cursor: pointer;
    transition: all var(--anim-speed) ease;
    display: flex; flex-direction: column; gap: 6px; text-align: left;
    box-shadow: 0 2px 0 var(--border); /* Effetto 3D "tasto" */
}

.answer-btn:not(:disabled):hover {
    background: var(--accent-light);
    border-color: var(--accent-primary);
    transform: translateY(-2px);
    box-shadow: 0 4px 0 var(--accent-primary); /* Tasto si alza */
}

.answer-btn .name { font-weight: 700; font-size: 1.05rem; color: var(--text-primary); }
.answer-btn .group { font-size: 0.85rem; color: var(--text-secondary); }

.answer-btn.correct {
    background: var(--success-bg) !important;
    border-color: var(--success) !important;
    box-shadow: 0 0 0 2px var(--success) !important;
}
.answer-btn.incorrect {
    background: var(--error-bg) !important;
    border-color: var(--error) !important;
}

.feedback-text {
    margin-top: 20px; font-size: 1.1rem; font-weight: 700;
    text-align: center; padding: 16px; border-radius: var(--radius-std);
    min-height: 60px; display: flex; align-items: center; justify-content: center;
}
.feedback-text.correct { color: var(--success); background: var(--success-bg); border: 1px solid var(--success); }
.feedback-text.incorrect { color: var(--error); background: var(--error-bg); border: 1px solid var(--error); }

/* --- ALTRE MODALITÀ --- */
#manual-image-container, #seat-image-container {
    width: 280px; height: 373px; margin: 0 auto 30px;
    border-radius: var(--radius-std); overflow: hidden;
    box-shadow: var(--card-shadow); border: 1px solid var(--border);
}
#manual-deputy-image, #seat-deputy-image { width: 100%; height: 100%; object-fit: cover; }

#manual-inputs-container, #seat-inputs-container {
    display: grid; grid-template-columns: 1fr; gap: 16px; margin-bottom: 20px;
}

#hints-container { display: flex; gap: 12px; justify-content: center; margin: 25px 0; }
#hints-display-area {
    margin-top: 15px; padding: 15px;
    background: var(--bg-secondary); border: 1px solid var(--border);
    border-radius: var(--radius-std); text-align: center;
    color: var(--text-primary); font-weight: 600;
}

#quiz-emiciclo-iframe {
    width: 100%; height: 600px; border: 2px solid var(--border);
    border-radius: var(--radius-std); background: var(--bg-secondary); margin-bottom: 15px;
}

#end-screen h1 { font-size: 3rem; margin-bottom: 20px; }
#final-score-text {
    font-size: 2rem; font-weight: 700; color: var(--accent-primary);
    margin: 30px 0 40px 0; text-align: center;
}

/* --- RIEPILOGO --- */
#results-summary-container {
    margin-top: 20px; margin-bottom: 30px; max-height: 400px; overflow-y: auto;
    border: 1px solid var(--border); border-radius: var(--radius-std); padding: 8px;
}
.result-summary-item {
    display: flex; align-items: center; gap: 16px; padding: 12px;
    border-bottom: 1px solid var(--border);
}
.result-summary-item:last-child { border-bottom: none; }
.result-summary-thumb {
    width: 50px; height: 66px; object-fit: cover;
    border-radius: 4px; flex-shrink: 0; border: 1px solid var(--border);
}
.result-summary-icon.correct { color: var(--success); }
.result-summary-icon.incorrect { color: var(--error); }

/* --- SEARCH & SELECTION --- */
#search-header, #selection-header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 30px; padding-bottom: 15px; border-bottom: 2px solid var(--border);
}
#search-filters, #selection-filters {
    display: grid; grid-template-columns: 1fr; gap: 20px;
}
@media (min-width: 768px) { #search-filters, #selection-filters { grid-template-columns: 1fr 1fr; } }

#search-results-container, #selection-results-container {
    margin-top: 30px; max-height: 450px; overflow-y: auto;
    border: 1px solid var(--border); border-radius: var(--radius-std); padding: 8px;
}
.search-result-item, .selection-result-item {
    display: flex; align-items: center; gap: 16px; padding: 12px;
    border-radius: var(--radius-std); cursor: pointer;
    transition: background 0.2s; border: 1px solid transparent;
}
.search-result-item:hover, .selection-result-item:hover {
    background: var(--accent-light); border-color: var(--accent-primary);
}
.selection-result-item.selected {
    background: var(--accent-light); border: 2px solid var(--accent-primary);
}
.result-thumb { width: 60px; height: 80px; object-fit: cover; border-radius: 4px; flex-shrink: 0; }
#no-results-text { text-align: center; padding: 40px; color: var(--text-secondary); }

/* Header Actions */
#selection-header-actions { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
#selection-counter { margin-right: 8px; font-weight: 600; color: var(--accent-primary); }

/* --- MODALE SCHEDA DEPUTATO (Solid Pop-up) --- */
#modal-overlay, #emiciclo-view-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.6); /* Sfondo scuro per focus */
    backdrop-filter: blur(5px); /* Blur leggero */
    display: flex; align-items: center; justify-content: center;
    z-index: 3000; animation: fadeIn var(--anim-speed) ease;
}
#modal-overlay.hidden, #emiciclo-view-overlay.hidden { display: none; }

#modal-content {
    background: var(--bg-primary);
    padding: 0; /* Padding interno gestito dai figli */
    border-radius: var(--radius-std);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    position: relative; max-width: 1100px; width: 92%; max-height: 90vh;
    display: flex; flex-direction: column; overflow: hidden;
}

#modal-close-btn {
    position: absolute; top: 10px; right: 10px;
    width: 40px; height: 40px; border-radius: 50%; border: none;
    background: var(--bg-tertiary); color: var(--text-primary);
    font-size: 1.5rem; cursor: pointer; z-index: 3005;
}
#modal-close-btn:hover { background: var(--error); color: white; }

/* Layout Responsive Modale */
@media (min-width: 1024px) {
    #modal-content { flex-direction: row; }
    #modal-info-col { 
        width: 360px; flex-shrink: 0; 
        padding: 40px; overflow-y: auto;
        border-right: 1px solid var(--border);
        background: var(--bg-secondary); /* Colonna sinistra distinta */
    }
    #modal-emiciclo { 
        flex-grow: 1; height: auto; width: auto; /* Riempie spazio */
        background: var(--bg-primary); border: none;
    }
}
@media (max-width: 1023px) {
    #modal-info-col { padding: 25px; text-align: center; max-height: 40vh; overflow-y: auto; }
    #modal-emiciclo { 
        width: 100%; flex: 1; min-height: 400px; /* Altezza minima sicura */
        border-top: 1px solid var(--border);
    }
}

#modal-image {
    width: 200px; height: 266px; object-fit: cover;
    border-radius: var(--radius-std); margin: 0 auto 20px; display: block;
    box-shadow: var(--card-shadow); border: 4px solid var(--bg-primary);
}
#modal-name { font-size: 1.8rem; font-weight: 800; color: var(--text-primary); margin-bottom: 5px; line-height: 1.2; }
#modal-group { font-size: 1.1rem; color: var(--accent-primary); font-weight: 700; margin-bottom: 15px; text-transform: uppercase; }
.modal-detail-text { font-size: 0.95rem; color: var(--text-secondary); margin-bottom: 5px; }

#modal-seat {
    display: inline-block; margin: 15px 0; padding: 8px 16px;
    background: var(--text-primary); color: var(--bg-primary);
    border-radius: 20px; font-weight: 700; font-size: 1rem;
}

#modal-committees-container {
    margin-top: 20px; border-top: 2px solid var(--border); padding-top: 20px; text-align: left;
}
#modal-committees-container h4 { font-size: 0.9rem; text-transform: uppercase; color: var(--text-tertiary); margin-bottom: 10px; letter-spacing: 1px; }
#modal-committees ul { list-style: none; }
#modal-committees li { padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 0.9rem; }

/* --- MODALE EMICICLO FULL --- */
#emiciclo-view-overlay { background: var(--bg-secondary); z-index: 2000; }
#emiciclo-view-content { width: 100%; height: 100%; }
#emiciclo-view-iframe { width: 100%; height: 100%; border: none; }
#emiciclo-view-close-btn {
    position: absolute; top: 20px; right: 20px; width: 50px; height: 50px;
    border-radius: 50%; border: none; background: var(--bg-primary);
    box-shadow: var(--card-shadow); font-size: 1.5rem; cursor: pointer; z-index: 2002;
}

/* Vecchia Legenda (Se usata) */
#emiciclo-view-legend {
    position: absolute; top: 20px; left: 20px;
    background: var(--bg-primary); border: 1px solid var(--border);
    border-radius: var(--radius-std); padding: 12px; box-shadow: var(--card-shadow);
    display: grid; grid-template-columns: 1fr; gap: 8px; z-index: 2001;
}
.group-label { padding: 6px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: 700; text-align: center; }
#label-avs { background: #FFA219; color: #000;} #label-pd { background: #FF0000; color: #fff;}
#label-m5s { background: #FFFF00; color: #000; } #label-aziv { background: #CC66FF; color: #fff; }
#label-misto { background: #7C7C7C; color: #fff;} #label-fi { background: #09ffff; color: #000;}
#label-nm { background: #FF33cc; color: #fff;} #label-lega { background: #33cc33; color: #000;}
#label-fdi { background: #0b52fc; color: #fff;}

/* --- UTILS --- */
.status-tag {
    color: var(--error); font-size: 0.75rem; font-weight: 800;
    margin-left: 8px; background: var(--error-bg); padding: 2px 6px; border-radius: 4px;
    text-transform: uppercase;
}
.checkbox-label {
    display: flex; align-items: center; cursor: pointer; font-size: 0.95rem; font-weight: 600; color: var(--text-secondary);
}
.checkbox-label input[type="checkbox"] {
    margin-right: 10px; width: 20px; height: 20px; cursor: pointer;
}

.site-footer {
    margin-top: 50px; padding-top: 25px; border-top: 1px solid var(--border);
    text-align: center; font-size: 0.9rem; color: var(--text-tertiary);
}
.site-footer a { color: var(--accent-primary); text-decoration: none; font-weight: 600; }
.site-footer a:hover { text-decoration: underline; color: var(--accent-hover); }

@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes zoomIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
.container > div:not(.hidden) { animation: fadeIn var(--anim-speed) ease; }

@media (max-width: 768px) {
    .container { padding: 20px; width: 100%; border-radius: 0; border: none; min-height: 100vh; }
    h1 { font-size: 2rem; }
    #answers-container { grid-template-columns: 1fr; }
    .theme-toggle { top: 15px; right: 15px; width: 40px; height: 40px; font-size: 20px; }
    #emiciclo-view-legend { display: none; /* Troppo piccolo su mobile */ }
    .manual-layout-grid { grid-template-columns: 1fr; }
    #selection-header { flex-direction: column; align-items: stretch; gap: 15px; }
    #selection-header-actions { justify-content: center; }
}